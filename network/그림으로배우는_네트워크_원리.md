
# 2장 네트워크를 만드는 것

## 네트워크를 구성하는 기기
![](/assets/network-1.JPG)

* 라우터
* 레이어2 스위치
* 레이어3 스위치

이 네트워크기기는 모두 데이터를 전송합니다. 데이터를 전송 처리는 주로 다음 3단계로 이루어집니다.

1. 데이터 수집: 전기신호 등 물리적 신호로 변환된 데이터를 원래 디지털 신호(0,1)로 되돌린다.
2. 데이터를 보낼 곳을 결정: 데이터에 부가된 제어 정보를 참조하여 전송할 곳을 결정한다.
3. 데이터 전송: 데이터를 물리적인 신호로 변환해서 내보낸다. 필요하면 제어 정보를 고쳐쓴다.

네트워크 기기의 차이는 두 번째 단계에 있습니다. 데이터는 다양한 제어 정보가 부가됩니다. 네트워크 기기의 동작 메커니즘에서는 어느 제어 정보를 참조해서 데이터를 보낼 곳을 결정하는지가 중요합니다.

## 네트워크의 구체적인 구성

### 인터페이스
네트워크 기기끼리나 PC, 서버 등 연결하기 위해 각각의 기기에는 인터페이스가 갖추어 있습니다. **현재 가장 일반적으로 이용되는 것은 이더넷 인터페이스입니다.**

인터페이스는 종종 포트라고도 불립니다. 인터페이스나 포트를 같은 의미라고 생각하면 됩니다. 이더넷 인터페이스는 이더넷 포트나 LAN 포트로 불립니다.

### 전송 매체와 링크
각 기기에 달린 인터페이스끼리 연결(링크)합니다. 인터페이스를 서로 연결하는 케이블을 전송 매체라고 합니다. 데이터를 변환한 전기신호 등 물리적인 신호가 전송 메체를 통해 전달되어 갑니다.

### 인터페이스는 무엇의 경계일까?
인터페이스는 경계라는 의미로, 네트워크 인터페이스는 `0`, `1`의 디지털 데이터와 전기신호와 같은 물리적 신호의 경계입니다. PC와 스마트폰 등 네트워크 기기가 다루는 `0`, `1`의 디지털 데이터는 전기신호 등 물리적 신호로 변환되어 인터페이스에서 송출되고, 링크로 전달되어 갑니다.

# 3장 네트워크의 공통 언어 TCP/IP

## TCP/IP 계층

![](/assets/network-2.JPG)

TCP/IP는 TCP와 IP를 중심으로 하는 프로토콜의 집합으로, 네트워크의 공통 언어입니다. TCP/IP에서는 네트워크를 통해 통신하기 위한 기능을 계층화하고 복수의 프로토콜을 조합하여 실현했습니다. TCP/IP의 계층구조는 아래부터 네트워크 `인터페이스 계층`, `인터넷 계층`, `트랜스퍼 계층`, 애플리케이션 계층이 있습니다.

4개의 계층의 프로토콜이 모두 정상적으로 제기능을 해야 비로소 통신이 이루어집니다. 그리고, **어떤 계층이 기능을 발휘하려면, 그 하위 계층이 정상적으로 동작한다는 것을 전제로 합니다.**


## 데이터를 전송하는 역할을 하는 계층

### 네트워크 인터페이스 계층
![](/assets/network-3.JPG)

**네트워크 인터페이스 계층의 역할은 같은 네트워크 안에서데이터를 전송하는 것입니다. 하나의 네트워크는 라우터와 레이어3 스위치로 구획되는 범위 또는 레이어2 스위치로 구성하는 범위입니다.**

예를 들어, 레이어 2 스위치에 연결된 PC의 인터페이스에서 같은 레이어2, 스위치에 연결된 다른 PC의 인터페이스까지 데이터를 전송할 수 있습니다. 그때. `0`, `1`의 디지털 데이터를 전기신호 등 물리적 신호로 변환해서 전송 매체로 전달해 갑니다. 
네트워크 인터페이스 계층의 구체적인 프로토콜로서 유선(이더넷)이나 무선 LAN(WI-FI),PPP 등이 있습니다. 네트워크 인터페이스계층의 프로토콜이 통신 상대와 같아야할 필요는 없습니다.

### 인터넷 계층

![](/assets/network-4.JPG)

한 네트워크에 모든 기기가 연결되는 것은 아닙니다. 많은 네트워크가 존재하고, 거기에 다양한 기기가 연결됩니다. **인터넷계층은 그 네트워크 사이에 데이터를 전송하는 역할을 합니다.**

네트워크끼리 연결하고 데이터를 전송하는 기기가 라우터입니다. 라우터에 의한 네트워크 간 전송을 가리켜 라우팅 이라고 합니다. 또한 **원격지 네트워크에서 최종적인 출발지와 목적지 사이의 데이터 전송을 가리켜 엔드투엔드 통신 이라고 부릅니다.**

인터넷계층에 포함되는 구체적인 프로토콜은 IP, ICMP, APP 등입니다. 엔드투엔드 통신에는 이용하는 프로토콜은 IP이고 ICMP, APP는 IP를 도와주는 프로토콜입니다.

## 애플리케이션의 동작을 준비하는 계층

### 트랜스포트 계층
트랜스포트 계층의 역할은 데이터를 적절한 애플리케이션에 배분하는 일입니다. 최하층부터 트랜스포트 계층까지 바르게 동작하면, 출발지와 목적지 애플리케이션 간에 데이터를 송수신할 수 있게 됩니다.

TCP/IP 트랜스포트 계층에 포함되는 프로토콜은 TCP, UDP입니다. TCP를 이용하면, 만약 어떤 이유로 데이터가 유실되되더라도 그 사실을 검출해 데이터를 다시 보내줍니다. TCP에는 엔드투엔드의 신뢰성을 확보해 주는 기능이 있습니다. 그 밖에도 데이터의 분할과 조립 등도 합니다.


### 애플리케이션 계층
애플리케이션 계층의 역할은 애플리케이션의 기능을 실행하기 ㅟ한 데이터의 형식과 처리 절차 등을 결정하는 것입니다. 단순한 `0`, `1`이 아니라 문자와 이미지 등 인간이 인식할 수 있도록 데이터를 표현합니다.


## 데이터 송수신 규칙

### 프로토콜의 제어정보 헤더를 만든다

![](/assets/network-5.JPG)

통신 주체인 애플리케이션이 데이터를 주고받게 하려면, 복수의 프로토콜을 조합할 필요가 있습니다. TCP/IP에서는 네 개의 프로토콜을 조합합니다.

**각 프로토콜에서는 각각의 기능을 실현하기 위한 제어 정보(헤더)가 필요합니다.** 데이터를 전송하는 프로토콜이라면, 헤더에는 출발지와 목적지 주소가 지정됩니다. **각 프로토콜은 데이터를 전송할 때 헤더를 추가합니다.** 헤더를 추가하는 처리를 캡슐화 라고 부릅니다. 프로토콜이 데이터를 받으면, 각 프로토콜 헤더를 바탕으로 적절하게 처리하여 헤더를 벗겨내고 다시 다른 프로토콜로 처리를 넘깁니다.


### 물리적 신호로 변환된다
![](/assets/network-6.JPG)

네트워크로 보내는 데이터에는 여러 프로토콜의 헤더가 추가됩니다.

## 데이터 수신, 전송할 때의 규칙

### 0과 1의 데이터로 되돌려 전송한다
![](/assets/network-7.JPG)

전송 매체로 보내는 물리적인 신호는 목적지와 웹서버까지 다양한 네트워크 기기를 거쳐 전송됩니다. **네트워크 기기는 수신한 물리적 신호를 일단 0과 1의 데이터로 되돌립니다.** 그리고 각각의 네트워크 기기의 동작에 대응하는 헤더를 참조하여 데이터를 전송해 갑니다.

### 헤더로 목적지를 확인하고 수신한다
![](/assets/network-8.JPG)

1. 웹 서버 애플리케이션이 동작하는 웹서버까지 물리적인 신호가 도착하면 0과 1의 데이터로 변환합니다
2. 이더넷 헤드를 참조해 자기 앞으로 온 데이터인지 확인합니다. 또한 FSC로 데이터에 오류가 없는지 확인합니다. 자기 앞으로 온 데이터라는 것을 알았다면, 이더넷 헤더와 FSC를 제거하고 IP 헤더 처리를 넘깁니다
3. IP에서는 IP 헤더를 참조해 자기 앞으로 온 데이터인지를 확인합니다. 자기 앞으로 온 데이터라면 IP 헤더를 제거하고 TCP로 데이터 처리를 넘깁니다.
4. 다음으로 TCP는 TCP헤더를 참조해 어느 애플리케이션의 데이터인지 확인합니다. TCP는 TCP 헤더를 제거하고 웹서버 애플리케이션으로 데이터 처리를 넘김니다.
5. 웹서버 애플리케이션까지 데이터가 도달하면 HTTP 헤더와 그 뒤의 데이터 부분을 처리합니다.


## 데이터를 부르는 방법이 다양하다

### 계층별로 데이터를 부르는 방법

![](/assets/network-9.JPG)

계층 | 데이터 명칭
---|-------
애플리케이션 계층 | 메시지
트랜스포트 계층 | 세그먼트(TCP), 데이터그램(UDP)
인터넷 계층 | 패킷 또는 데이터그램
네트워크 인터페이스 계층 | 프레임

## 데이터를 목적지 까지 전송한다

### IP란?
IP의 역할은 **엔드투엔드 통신을 하는 것입니다. 네트워크 상의 어떤 PC에서 다른 PC 등으로 데이터를 전송하는 것이 IP의 역할입니다.** 출발지와 목적지는 같은 네트워크에 있든 다른 네트워크에 있든 어느 쪽이라도 상관 없습니다.

### 보내고 싶은 데이터를 IP 패킷으로 만든다

![](/assets/network-10.JPG)

IP로 데이터를 전송하기 위해서는 데이터에 IP 헤더를 추가해 IP 패킷으로 만들어야합니다. IP 헤더에는 여러 정보가 포함되어 있지만, 가장 중요한 것은 IP 주소입니다. IP 주소를 이용해 데이터의 출발지와 목적지를 나타내기 때문입니다. 

IP로 전송하는 데이터란, 애플리케이션 데이터에 애플리케이션 계층 프로토콜의 헤더와 트랜스포 계층 프로토콜의 헤더가 추가된 것입니다. 그리고 IP 패킷에는 다시 네트워크 인터페이스 계층 프로토콜의 헤더가 추가되어 네트워크로 보내집니다.

![](/assets/network-11.JPG)

**목적지가 다른 네트워크에 접속된 경우는 중간에 라우터가 존재합니다. 출발지 호스트에서 보낸 IP 패킷은 경로에 있는 라우터가 전송해서 최종적으로 목적지 호스트까지 도달합니다. 라우터가 IP 패킷을 전송하는 것을 가리켜 라우팅 이라고합니다.**

## 통신 상대는 누구 ?

### IP 주소의 개요
**IP 주소란 TCP/IP에서 통신 상대가 되는 호스트를 식별하기 위한 식별 정보입니다.** TCP/IP 통신을 할 때 데이터에는 IP 헤더를 추가해 IP 패킷으로 만듭니다. IP 헤더에는 목적지 IP 주소와 출발지 IP주소가 지정되어야만 합니다. 

### 인터페이스에 IP 주소를 설정한다

![](/assets/network-12.JPG)
IP 주소는 이더넷 등의 인터페이스와 연관 지어 설정합니다. IP 프로토콜은 호스트의 운영체제에서 동작합니다. 그리고 호스트 내부에서 인터페이스의 IP의 프로토콜 부분을 연관 지어 IP 주소를 설정하게 됩니다. PC 등에는 복수의 인터페이스를 탑재할 수도 있습니다. 인터페이스마다 IP 주소를 설정할수 있으므로 **IP 주소는 호스트 자체가 아니라 정확하게는 호스트의 인터페이스입니다.**



### IP 주소 표기하기

![](/assets/network-13.JPG)

IP 주소는 32비트 이므로 0, 1으로 32개 나열됩니다. 보통 8비트씩 10진수로 표현하고 `.`으로 구분하여 사람이 인식하기 쉽게 표기합니다. 이런 표기법을 도트형 10진 표기 라고 부릅니다.

## 목적지는 하나? 아니면 여러개 ?

### 데이터를 전송하는 주소의 차이
IP로 데이터를 전송할 때 목적지가 하나든 여러 개든 상관 없습니다 목적지가 단 하나인지, 그렇지 않으면 어러 개 인지에 따라 데이터 전송하는 방식을 3가지로 분류할 수 있습니다.

#### 유니캐스트

![](/assets/network-14.JPG)

**단 한 곳으로 데이터를 전송하는 것을 유니캐스트라고 부릅니다.** 유니캐스트에 이용하는 IP 주소가 유니캐스트 IP주소입니다. PC 등에는 유니캐스트 IP 주소를 설정합니다. 유니캐스트 데이터 전송에는 목적지 호스트의 유니캐스트 IP 주소를 IP 헤더의 목적지 IP로 지정합니다.

만약 완전히 같은 데이터를 복수의 주소로 저송하고 싶은 때는 출발지에 목적지 같은 데이터를 복수의 주소로 효율적으로 전송하기 위해서는 브로캐스트와 멀티캐스트를 사용합니다.

#### 브로캐스트

![](/assets/network-15.JPG)
**같은 네트워크 상의 모든 호스트에 완전히 똑같은 데이터를 전송하는 것을 브로트캐스트 라고합니다.** IP 헤더의 목적지 IP 주소에 브로드캐스트 IP 주소를 지정한다면, 같은 네트워크 상의 모든 호스트에 데이터를 전송할 수 있습니다.

#### 멀티캐스트
![](/assets/network-16.JPG)

**같은 애플리케이션이 동작하는 등 특정 그룹에 포함되는 호스트에 완전히 똑같은 데이터를 전송하는 것을 멀티 캐스트라고 합니다.** IP 헤더의 목적이 IP 주소에 멀티캐스트 IP 주소를 지정합니다.

## IP 주소의 구성은 크게 나누 두 가지

### 유니캐스트 IP 주소의 구성

![](/assets/network-17.JPG)

**PC와 서버 등 TCP/IP 통신을 하는 호스트에 설정하는 IP 주소는 유니캐스트 IP 주소입니다. TCP/IP 통신은 대부분 유니캐스트입니다.**

IP 주소는 네트워크 주소, 호스트 주소 라는 두 개의 부분으로 구성됩니다. 사내 네트워크와 인터넷 등의 복수의 네트워크가 라우터 또는 레이어3 스위치로 서로 연결되어 있습니다. IP 주소의 전반의 네트워크 주소를 이용해 각 네트워크를 식별합니다. 그리고 후 반의 호스트 주소 네트워크 내 호스트(의 인터페이스)를 식별합니다.

### 브로드캐스트 IP 주소
같은 네트워크에 있는 모든 호스트에 일괄적으로 데이터를 전송 할 때 이용하는 브로트캐스트 IP 주소는 32가 모두 1인 IP 주소입니다. 토드형 10진 표기로는 `255.255.255.255`가 브로드캐스트 IP 주소입니다. 유니캐스트 IP주소 후반 호스트 주소의 모든 비트가 `1`로 된 IP 주소도 브로드캐스트 IP 주소입니다.

### 멀티캐스트 IP 주소
멀티캐스트 IP 주소로서 `224.0.0.0 ~ 239.255.255.255`로 범위가 정해져 있습니다. 이 범위 중, 미리 정해져 있는 멀티캐스트 IP주고 있습니다. 예를 들어 `244.0.0.2`라는 멀티캐스트 IP 주소는 같은 네트워크 상의 모든 라우터라는 그룹입니다.

## 네트워크에 접속하는 두 단계

### 물리적인 접속 논리적인 접속

![](/assets/network-18.JPG)

네트워크에 접속할 때는 물리적인 접속과 논리적인 접속 두 단계가 있습니다. **TCP/IP의 계층으로 말하면, 물리적인 접속은 네트워크 인터페이스 계층이고, 논리적인 접속은 인터넷 계층입니다.**

물리적인 접속이란 물리적 신호를 주고 받을 수 있게 하는 것입니다. 구체적으로는 이더넷 인터페이스의 LAN 케이블 삽입하거나 무선 LAN 액세스를 포인트에 접속하거나 휴대전화 기지국의 전파를 포착하는 등의 일입니다.

그리고 물리적으로 접속이 이루어진 후에, 논리적인 접속으로 IP 주소 설정도 필요해집니다. 현재는 TCP/IP를 네트워크 공통 언어로 사용하고 있고, TCP/IP에서는 IP 주소를 지정하여 통신합니다. 그러므로 IP 주소가 없으면 통신할 수 없습니다.

예를 들어 호스트 IP 주소에 `192.168.1.1/24`를 설정함으로써, 그 호스트는 `192.168.1.0/24`인 네트워크에 접속해서 TCP/IP를 사용한 통신을 할 수 있게 됩니다.

이런 설정을 DHCP 등의 기술로 자동으로 설정하고, 사용자에게 IP 주소를 설정을 의식하지 않게 할 수있습니다. **LAN 케이블을 꽂아 물리적인 접속이 완료되면, 자동으로 논리적인 접속도 완료할 수 있게 합니다.**

## 인터넷에서 사용하는 주소와 사실 네트워크에서 사용하는 주소

### IP 주소의 이용 범위
IP 주소는 이용 범위에 따라. `공인 IP 주소`, `사설 IP 주소`의 2가지로 분류됩니다. 공인 주소는 인터넷에서 이용하는 IP 주소입니다. 인터넷에서 통신하기 위해서는 반드시 공인된 주소가 필요합니다. 공인 주소는 인터넷 전체에서 중복되지 않도록 관리됩니다.

그리고 사내 네트워크 등의 사설 네트워크에서 이용하는 IP 주소가 사설 주소입니다. 사설 주소의 범위는 다음과 같습니다. 다른 네트워크와의 사설 주소가 겹치더라도 사설 네트워크 안의 통신에는 전혀 문제가 없습니다.

```
10.0.0.0 ~ 10.255.255.255
172.16.0.0 ~ 172.31.255.255
192.168.0.0 ~ 192.168.255.255
```

### 사설 네트워크에서 인터넷으로 통신
사설 주소를 이용하는 사설 네트워크에서 인터넷으로 통신 할 때는 사설 주소 그대로는 통신할 수가 없습니다. 사설 네트워크에서 인터넷으로 통신하려면, NAT(Network Address Translation)가 필요합니다.

## 사설 네트워크에서 인터넷으로 통신

### 사설 주소 그대로는 응답이 돌아오지 않는다

![](/assets/network-19.JPG)

사설 네트워크에서 인터넷으로 그대로 통신할 수는 없습니다. **사설 네트워크의 PC에서 인터넷의 서버 요청을 보내면, 목적지는 공인주소이고, 출발지는 사설 네트워크입니다. 이때 요청은 서버로 문제없이 보낼 수 있습니다.**

서버에서 응답을 돌려 보낼 때는 목적지가 사설 네트워크이고 출발지는 공인 네트워크입니다. 하지만 **응답은 돌아오지 않습니다. 인터넷에서는 목적지가 사설 주소로 된 IP 패킷은 반드시 폐기되어 버리기 때문입니다.**

### 주소를 변환한다.
![](/assets/network-20.JPG)

사설 네트워크에서 인터넷으로 통신하기 위해서는 다음과 같은 NAT로 주소를 변환합니다.

1. 사설 네트워크에서 인터넷으로 요청을 전송할 때 출발지 IP주로를 변환합니다.
2. 라우터는 나중에 원래대로 되돌리기 위해서 변환의 주소의 대응을 NAT 테이블에 보존해둔다
3. 요청에 대한 응답이 라우터로 돌아오면, 목적지 IP 주소를 변환합니다. 이때. NAT 테이블에 보존해 둔 주소의 대응을 이용합니다.

수의 사설 주소를 하나의 글로벌 주소에 대응시키는 주소 변환을 NAPT(Network Address Port Translation)라고 부릅나다.

## 데이터가 목적지에 잘 도착했을까?

### IP는 확인하지 않는다.

![](/assets/network-21.JPG)

IP로 데이터를 다른 호스트에 전송하지만, **IP에는 제대로 도착했는지 확인할 방법이 없습니다**. 전송하고 싶은 데이터에 IP 헤더를 붙여 IP 패킷으로 반들어 네트워크 상에 보내기만 할 뿐입니다. 목적지까지 도달하면 그 응답이 돌아올테지만, 목적지까지 도달하지 않았다면 아무리 기다려도 응답이 돌아오지 않습니다. 게다가 도달하지 못한 이유조차 알 수 없습니다. 이런 IP를 이용하는 데이터 전송의 특징을 최선형이라고 합니다. **데이터를 보내기 위해 최선을 다하겠지만, 안 되도 어쩔 수 없지 라는 것이 IP의 특징입니다.**

그래서 **별도의 IP에 의한 엔드투엔드 통신이 정상적으로 이루어졌는지 확인하는 기능을 갖춘 프로토콜 ICMP가 개발됐습니다.**

### ICMP의 기능
ICMP의 주요 기능은 다음 두 가지 입니다
* 에러 리포트
* 진단 기능

![](/assets/network-22.JPG)

**어떤 이유로 IP 패킷을 폐기했다면, 폐기한 기기가 ICMP를 이용해 폐기한 IP 패킷의 출발지로 에러 리포트를 전송합니다.** 이 에러 리포트를 도달불가능 메시지라고 부릅니다. 도달불능 메시지로 엔드투엔드 통신에 실패한 원인을 통지 합니다.

진단 기능은 IP의 엔드투엔드 통신이 가능한지 확인하는 기능입니다. 진단을 위해서 매우 자주 이용하는 명령으로 ping 커멘드가 있습니다. ping 커멘드로는 ICMP 에코 요청/응답 메시지를 보내서, 지정한 IP 주소와 통신할 수있는지 확인합니다.

## IP 주소와 MAC 주소를 대응 시킨다

### ARP란 ?

![](/assets/network-23.JPG)

TCP/IP에서 IP주소를 지정해서 데이터(IP 패킷)를 전송합니다. IP 패킷은 PC나 서버 등의 인터페이스까지 전송되어 갑니다. **PC나 서버 등의 인터페이스는 MAC 주소로 식별합니다. TCP/IP 주소와 인터페이스를 식별하기 위한 MAC 주소를 대응시키는 것이 ARP의 역할 입니다.**

이더넷 인터페이스에서 IP 패킷을 내보낼 때는 이더넷 헤더를 덧붙입니다. **이더넷 헤더에는 목적지 MAC 주소를 지정헤야만 합니다. 목적지 IP 주소에 대응하는 MAC 주소를 구하기 위해서 ARP를 이용합니다.**

### ARP 동작의 흐름

![](/assets/network-24.JPG)

**ARP의 주소 해석 범위는 같은 네트워크 내의 IP 주소입니다.** 이더넷 인터페이스로 접속된 PC 등의 기기가 IP 패킷을 송신하고자 목적지 IP 주소를 지정할 때, 자동으로 ARP가 수행됩니다.

1. ARP 요청으로 IP 주소에 대응하는 MAC 주소를 질의한다.
2. 질의받은 IP 주소를 가진 호스트가 ARP 응답으로 MAC 주소를 알려준다
3. 주소 해석한 IP 주소와 MAC 주소의 대응을 APP 캐시에 보존한다.

## 포트 번호로 애플리케이션에 할당한다

### 포트 번호의 역할
호스트에서 동작하는 애플리케이션에 데이터를 배분하기 위헤서는 각각의 애플리케이션을 식별 할 수 있어야 합니다. 애플리케이션을 식별하는 데에는 포트 번호를 이용합니다.

## 확실하게 애플리케이션의 데이터를 전송한다

### TCP란?
TCP란 신뢰성이 있는 애플리케이션 간의 데이터 전송을 하기 위한 프로토콜입니다. **TCP를 이용하면, 애플리케이션 프로토콜에는 신뢰성을 확보 하기 위한 구조를 넣어둘 필요가 있습니다.**

### TCP에 의한 데이터 전송 절차

1. TCP 커넥션 맺기
2. 애플리케이션 간 데이터 송수신
3. TCP 커넥션 끊기

우선 데이터를 송수신하는 애플리케이션 간의 통신이 정상적으로 이루어질 수 있는지를 확인합니다. 이 확인 프로세스는 3웨이 핸드쉐이크라고 부릅니다.

다음으러 애플리케이션이 다루는 데이터를 TCP로 송신하기 위해서는, 애플리케이션의 데이터에 애플리케이션 프로토콜 헤더와 TCP 헤더를 추가할 필요가 있습니다. 이를 TCP  세그먼트라고 표현하기도 합니다. **이 때 애플리케이션의 데이터 크기가 크면 분할하여 복수의 TCP 세그먼트로서 전송합니다.**

만약 데이ㅌ가 도착하면 받았다고 확인해 줍니다. 데이터 수신을 확인을 ACK라고 부릅니다. **만약, 일부 데이터가 제대로 도착하지 않았다면 데이터를 재존송합니다.**

## TCP로 데이터를 분할한다

### TCP 헤더 형식

![](/assets/network-25.JPG)

TCP로 전송하고 싶은 애플리케이션의 데이터에 TCP 헤더를 추가해, TCP 세그먼트라고 합니다. 

TCP 헤더에서는 포트 번호가 중요합니다. **포트 번호로 적절한 애플리케이션 프로토콜에 데이터를 배분할 수 있기 때문 입니다**

그리고, 신뢰성 있는 데이터 전송을 위해서 시퀀스 번호와 ACK 번호라는 것이 있습니다. 시퀀스 번호는 `시퀀스(순서)`라는 이름 처럼 TCP로 전송하는 데이터 순서를 나타냅니다. 데이터가 분할되어 있을 땨에는 시퀀스 번호로 어떻게 데이터를 분할했는지 알 수있습니다. ACK 번호는 데이터를 바르게 수신했음을 확인하기 위해 이용합니다.

### 데이터 분할 구조

![](/assets/network-26.JPG)

TCP에는 데이터 분할하는 기능도 있습니다. TCP에서 애플리케이션의 데이터를 분할하는 단위 MSS라고 부릅니다. **MSS를 넘기는 데이터는 MSS 단위로 나누어 송신합니다.** MSS의 표쥰 크키는 1460 바이트입니다.

1. 애플리케이션 프로토콜로 HTTP를 이용하 므로 웹사이트의 데이터에는 HTTP헤더가 추가됩니다. 이것이 TCP가 처리할 데이터 입니다.
2. MSS로 나누고 각각에 TCP 헤더 내 시퀀스 번호를 부여합니다.

## 애플리케이션에 데이터를 배분하기만 한다

### UDP
UDP는 PC나 서버 등에 도달한 데이터를 적절한 애플리케이션에배분하는 기능만 있는 프로토콜입니다. TCP와 같은 확인은 전혀하지 않습니다.

### UDP 이용 사례
UDP는 상대방의 애플리케이션이 동작하는지 등을 확인하지 않은 채 무조건 UDP 데이터그램으로 애플리케이션의 데이터를 전송합니다. 이러한 특징 때문에 TCP만큼 여분의 처리를 하지 않으므로, 데이터 전송 효율이 좋다는 장점이 있습니다.

UDP는 크기가 큰 데이터를 분할하는 기능도 없습니다. 그러므로 전송해야할 애플리케이션의 데이터 크키가 클 때 에는 애플리케이션 쪽에서 적절한 크기로 쪽개야만 합니다.

## 네트워크의 전화번호부

### 반드시 IP 주소를 지정한다
네트워크 공통 언어로 되어 있는 TCP/IP 통실 할 때는 통신 상대방의 IP 주소를 반드시 지정해야만 합니다.

### 이름 해석
사용자가 URL 등으로 애플리케이션의 주소를 지정하면, 호스트 이름에 대응하는 IP 주소를 자동으로 구하는 것이 DNS의 역할 입니다. 이처럼 호스트명에서 IP 주소를 구하는 방법을 이름 해석이라고 부릅니다.

### 네트워크의 전화번호부

![](/assets/network-27.JPG)

TCP/IP 통신에 필요한 IP 주소는 TCP/IP 네트워크 전화부인 DNS에 문의해서 조사합니다.

## DNS로 IP 주소를 자동으로 구한다

### DNS 서버

종류 | 의미
---|---
A | 호스트명에 대응하는 IP 주소
AAA | 호스트명에 대응하는 IPv6 주소
CNAME | 호스트명에 대응하는 별명
MX | 도메인명에 대응하는 메일 서버
NS | 도메인명에 대응하는 DNS 서버
PTR | IP 주소에 대응하는 호스트명


DNS를 이용하면 DNS 서버가 필요합니다. DNS 서버에 미리 호스트명과 IP 주소의 대응 관계를 등록해둡니다. DNS 서버에 등록하는 정보를 리소스 레코드라고 부릅니다.

### DN의 이름 해석

![](/assets/network-28.JPG)
**DNS 서버는 루트를 정점으로 한 계 층 구조로 되어 있습니다.**

그리고 애플리케이션이 동작하는 호스트에 DNS 서버의 IP 주소를 설정해둡니다. 애플리케이션을 이용하는 사용자가 호스트 이름을 지정하면, 자동으로 DNS 서버에 대응하는 IP 주소를 질의합니다. **DNS 서버에 질의하는 기능은 OS에 내장되어 있고 DNS 리졸버라고 부릅니다,**

질의한 호스트명에 관한 정보가 반드시 가까운 DNS 서버에있다고는 할 수 없습니다. 자신이 관리하는 도메인 이외의 호스트명을 찾으러면 루트로 부터 여러번 질의를 반복 해야합니다. 이처럼 DNS가 이름 해석을 반복해서 묻는 것을 재귀지르이 라고 부랍니다. **DNS 서버와 리졸버는 질의한 정보를 한동한 캐시에 보존합니다.**

## 필요한 설정을 자동화한다

### 설정을 자동화하는 DHP

설정을 자동화하는 프로토콜이 DHP 입니다. 

### DHCP의 동작

![](/assets/network-29.JPG)

DHCP를 이용하면 미리 DHCP 서버를 준비하고, 할당 IP 주소 등 TCP/IP설정을 등록해 줍니다. 그리고 PC 등에서 DHCP 클라이언트라 되도록 설정합니다. 

DHCP의 통신은 브로드캐스트를 이용합니다. 애초에 DHCP 클리언트는 자신의 IP 주소는 무론이고 DHCP 서버의 IP 주소조차 알 수 없습니다. 주소를 몰라도 일단 뭔가 데이터를 보내고 싶을 때는 브로도캐스를 이용합니다.버
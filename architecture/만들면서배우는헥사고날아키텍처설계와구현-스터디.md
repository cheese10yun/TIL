# 만들면서 배우는 헥사고날 아키텍처 설계와 구현

# 01 왜 헥사고날 아키텍처인가?

> 필리포 부루넬리스키가 자신의 아이디어가 올바르다는 것을증명하기 위해서 스스로 건물에 벽동을 쌓았던 피렌체 대성당의 예와 같이, 소프트웨어 아키텍트는 자신의 아키텍처가 훌륭하다는 것을 증명하기 위해 손을 더렵혀야 한다.

* 엔티티 * 값 객체 * 애플리케이션 헥사곤 * 프레임워크 헥사곤 * 드라이빙 오퍼레이선 * 드리븐 오퍼레이션 * 유스케이스 * 입력포트 * 출력포트


## Value Object

### Value Object 재사용

```kotlin
data class Address (
    val address: String,
    val addressDetail: String,
    val zipCode: String
)
```

```kotlin
class Member(
    val address: Address
)
```

```kotlin
// 
class Controller {
    
    
    @Post
    fun create(@RequestBody @Valid dto: MemberXXXRequest){
        
    }
}

data class MemberXXXRequest(
    // Value Object 를 그대로 사용해야 하느가?
    val address: Address
)

// 그렇게 되면 @file:NotEmpty 와 같은 의존성이 생기는데, 또 이게 외부 포트이기 때문에 분리해야하지 않나?
data class Address (
    @file:NotEmpty
    val address: String,
    @file:NotEmpty
    val addressDetail: String,
    @file:NotEmpty
    val zipCode: String
)
```


### Rich Object

```kotlin
@Document(collection = "members")
class Member(
    @Field(name = "member_id")
    val memberId: String,

    @Field(name = "name")
    val name: String,

    @Field(name = "email")
    val email: String,

    @Field(name = "address")
    val address: Address
){
    // val 이기 때문에 email 업데이트 코드가 없다.
}


// val 으로 만들고 업데이트만 하면 어떨지?..
class MemberCustomRepositoryImpl {

    override fun updateEmail() {
        val query = Query(Criteria.where("_id").`is`(1))
        val update = Update().set("email", "sample@asd.com")

        mongoTemplate.updateFirst(
            query,
            update,
            documentClass
        )
    }
}

// 순수하게 MemberRepositroy만 의존하는 관계
class MemberQueryService(
    private val memberRepository: MemberRepositroy
) {
    fun updateEmail() {
        // 기타 로직 작성
        memberRepository.update()
    }
}

// 행위를 위해서 모든 의존성을 가져온다.
class MemberEmailService(
    private val memberQueryService: MemberQueryService
) {
    fun updateEmail() {
        // 기타 로직 작성
        memberQueryService.update()
    }
}
```

#### Rich Obejct의 현실적인 한계

https://cheese10yun.github.io/code-design/#projection



# 02 도메인 헥사곤으로 비즈니스 규칙 감싸기

* 엔티티는 인프라스트럭처에 해당하는가 ?
* 빈약한 모델
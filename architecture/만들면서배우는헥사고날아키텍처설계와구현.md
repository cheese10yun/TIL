# 만들면서 배우는 헥사고날 아키텍처 설계와 구현

# 01 왜 헥사고날 아키텍처인가?

> 필리포 부루넬리스키가 자신의 아이디어가 올바르다는 것을증명하기 위해서 스스로 건물에 벽동을 쌓았던 피렌체 대성당의 예와 같이, 소프트웨어 아키텍트는 자신의 아키텍처가 훌륭하다는 것을 증명하기 위해 손을 더렵혀야 한다.

## 소프트웨어 아키텍처 검토

### 아키텍처는 모두를 위한 것이 아니다.

회사에서 이윤을 주도하는 소프트웨어가 완전히 커다란 진흙 덩어리인 경우가 있다. 이것은 무질서하게 성장해서 이해하거나 유지하기에는 복잡한 소프트웨어를 말한다. 이러한 종류의 시스템이 이야기하는 복잡성을 해결하려는 개발자는 히드라와 싸우는 전사와 같다. 간혹 이러한 복잡성에 질서를 부여하기 위한 리팩터링 활동이 아무런 가치가 없을 때도 있다.

고객 기능 면에서 큰 가치를 더하지 않는 기술저깅ㄴ 츤면을 처리하는 데 더 많은 시간을 쓰는 것이 장기저긍로 중요한 역할을 하루 ㅅ있다는 점을 이해하는 것이 중요하다. 이러한 모든 노력은 더 유지보수하기 쉬윈 소프트웨어로 보상 받는다. 이 제 개발 자는 더 이상 골치 아픈 문제와 씨름할 필요가 없어지고 관리자는 마감을 맞추는 데 더 유리한 위치에 놓이게 된다.


### 모노로식 시스템과 분산 시스템

특히 마이크로서비스 아키텍처는 컴퓨팅 및 네트워크 리소스가 예전만큼 비싸지 않고 강력한 디커플링과 더 빠른 소프트웨어 전달과 관련된 많은 이점이 있다. 그러나 여기에도 비용은 든다. 지금까지 한곳에서 복잡성을 처리해야 했다면, 이제는 네트워크 전체에 흩어져 있는 복잡성을 처리해야 하기 때문이다.

## 헥사고날 아키텍처 이해

**헥사고날 아키텍처의 주된 아이디어 중 하나는 비즈니스 코드를 기술 코드로 부터 분리하는 것이다.** 그뿐만 아니라 기술 측면이 비즈니스 측면에 의존하는지도 확인해 비즈니스 측면이 비즈니스 목표를 달성하는 데 사용되는 기술에 대한 우려 없이도 발전할 수 있게 헤야한다. 

비즈니스 코드가 어디에 존재하는지 기술 문제로부터 격리되고 보호돼야 하는 위치를 걸졍해야 한다. 이것은 우리의 첫 번 째 헥사곤, 즉 도메인 헥사곤을 생성하게 할 것이다.

도메인 헥사곤에서 소프트웨어가 해결하기를 원하는 핵심 문제를 설명하는 요소들을 결합한다, 도메인 헥사곤에서 활용되는 주된 요소는 Entity, Value Object다.

또한 도메인 헥사곤에서 나오는 비즈니스 규칙을 사용, 처리하고 조정하는 방법이 필요하다. 이는 애플리케이션 헥사곤이 하는 일이다. 애플리케이션 헥사곤은 비즈니스 측면과 기술 측면 사이에 있으며 양 쪽과 상호작용하는 중개자 역할을 한다.

프레임워크 헥사곤은 외부 인터페이스를 제공한다. 프레임ㅇ ㅓ크 헥사곤은 애플리케이션 기능의 노출 방법을 결정할 수 있는 곳이다.


### 도메인 헥사곤

* 엔티티
* 값 객체

### 유스케이스

유스케이스는 도메인 제약사항을 지원하기 위해 시스템을 동작을 소프트웨어 영역 내 존재하는 애플리케이션 특화 오퍼레이션을 통해 나타낸다.

```java
public interface RouterViewUseCase {
    List<Router> getRouters(Predicate<Router> filter);
}
```
Predicate 필터를 눈여거보자, 이것은 유스케이스를 구현할 때 라우터 리스트를 필터링하는 데 사용할 것이다.


### 입력 포트
유스케이스가 소프트웨어가 하는 일을 설명하는 인터페이스라면 여전히 유스케이스 인터페이스를 구현해야 한다. 이것이 입력 포트의 역할이다. 애플리케이션 수준에서 유스케이스에 직접 연결되는 컴포넌트가 되기 때문에 입력 포트 도메인 용어로 소프트웨어를 의도를 구현할 수 있게 한다.

```java
public RouterViewInputPort Implements RouterViewUseCase {
    private final RouterViewOutPort routerViewOutPort;

    @Override
    List<Router> getRouters(Predicate<Router> filter) {
        // ...
        return Router....
    }
}
```

### 출력포트

유스케이스가 먹표를 달성하기 위해 외부 리소스에서 데이터를 가져와야 하는 상황이 있다. 이것은 출력 포트의 역할이다. 출력 포트는 유스케이스나 입력포트가 오퍼레이션을 수행하기 위해 어떤 종류의 데이터를 외부에서 가져와야 하는지를 기술에 구애 받지 않고 설명하는 인터페이로 표현된다.

```java
public interface RouterViewOutputPort {
    List<Router> fetchRouters();
}
```


### 프레임워크 헥사곤

통신은 두 가지 형태로 발생할 수 있다. 하나는 드라이빙 방식이고, 다른 하나는 드리븐 방식이다. 드라이버 관점의 경우 입력 어댑터를 사용한다. 그리고 드리븐 관점에서는 출력 어뎁터를 사용한다.


#### 드라이빙 오퍼레이션과 입력 어뎁터

드라이빙 오퍼레이션과 입력 어뎁터은 소프트웨어 동작을 요청하는 것이다, 예를 들어 드라이빙 오퍼레이션은 명령행 클라이언트를 갖는 사용자나 사용자를 대신하는 프론트엔드 애플리케이션이 될 수 있다.



#### 드리븐 어포레이션과 출력 어댑터

드라이빙 오퍼레이션의 반대편에는 드리븐 오퍼레이션이 있다. 이 어포레이션은 애플리케이션에서 트리거가되고, 외부에서 소프트웨어 요구사항을 충족시키는 데 필요한 데이터를 가져온다. 일반적으로 드리븐 어포레이션은 일부 드라이빙 어포레이션에 응답해 발생한다. 상상할 수 있듯 출력 어댑터를 통해서 드리븐 오퍼레이터를 정의한다.


## 용어 정리

엔티티 (Entity):

애플리케이션의 핵심 비즈니스 로직을 담는 객체입니다. 보통 데이터베이스의 테이블과 매핑되며, 식별자를 가지고 있어 동일성을 유지합니다.
값 객체 (Value Object):

엔티티와 달리 식별자를 가지지 않는 객체로, 데이터의 속성을 나타냅니다. 값 객체는 불변성을 가지며, 엔티티의 속성으로 사용됩니다.
애플리케이션 헥사곤 (Application Hexagon):

헥사고날 아키텍처의 중심부로, 애플리케이션의 핵심 비즈니스 로직을 담고 있습니다. 이 영역은 외부의 변경으로부터 보호되며, 포트를 통해 외부와 통신합니다.
프레임워크 헥사곤 (Framework Hexagon):

헥사고날 아키텍처의 외부 부분으로, 애플리케이션과 외부 시스템(데이터베이스, 웹 서버 등) 사이의 상호작용을 처리합니다.
드라이빙 오퍼레이션 (Driving Operation):

애플리케이션의 핵심 로직을 "호출"하는 외부 요청입니다. 예를 들어, 사용자의 API 요청이나 이벤트가 이에 해당합니다.
드리븐 오퍼레이션 (Driven Operation):

애플리케이션에서 외부 시스템(데이터베이스, 메시징 시스템 등)으로의 "응답" 또는 "요청"입니다.
유스케이스 (Use Case):

애플리케이션에서 수행되는 특정 비즈니스 로직의 흐름입니다. 유스케이스는 사용자 또는 외부 시스템의 요구를 충족시키기 위해 정의됩니다.
입력포트 (Input Port):

드라이빙 오퍼레이션을 애플리케이션 헥사곤으로 전달하는 인터페이스입니다. 이를 통해 외부 요청이 애플리케이션의 핵심 로직으로 전달됩니다.
출력포트 (Output Port):

드리븐 오퍼레이션을 처리하기 위한 인터페이스입니다. 애플리케이션의 핵심 로직이 외부 시스템과 상호작용할 때 사용됩니다.



# 02 도메인 헥사곤으로 비즈니스 규칙 감싸기

## 앤타타룰 활용한 문제 영역 모델링

* 보편 언어
* 공영 언어

### 도메인 엔티티의 순수성

* 도메인은 인프라 스트럭처인가 아닌가 ?


### 관련 엔티티

* 빈약한 모델


# 03 포트와 유스케이스를 통한 동작 처리

* 유스케이스를 통한 소프트웨어의 동작 표현
* 입력 포트를 갖는 유스케이스 구현
* 출력 포트를 이용한 외부 데이터 처리
* 애플리케이션 헥사곤을 통한 동작 자동화

## 유스케이스를 통한 소프트우ㅐ어 동작 표현

* 소프트웨어의 동작은 단독, 혹은 다른 ㅅ프트웨어 ㄷㅇ작과 결합해 가치 있는 소프트웨어 목표를 실현하는 데 기여하는 의미 있는 해동이다.
* 유스케이스는 SuD 목표, 목표를 충족하기 위한 수단이나 행위, 가능한 실패 시나리오와 이들이 발생하는 경우에 수행해야할 작업을 설정하는 귀중한 기법이다. 